<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>uncharted test page</title>
<style type="text/css">
	body{
		background:#ccc;
	}
	#paper{
		background:#fff;
		width:500px;
		height:400px;
	}

</style>
</head>
<body>

<div id="paper">
	
</div>
<div id="chart">
	
</div>

<script language="Javascript" type="text/javascript" src="js/raphael/raphael.1.3.1.js"></script>
<script language="Javascript" type="text/javascript" src="js/raphael/g.raphael.0.4.js"></script>
<script language="Javascript" type="text/javascript" src="js/raphael/g.pie.0.4.js"></script>
<script language="JavaScript" type="text/javascript">
	
	var colors = ["#edc240", "#00A8F0", "#C0D800", "#cb4b4b", "#4da74d", "#9440ed"];
	var data = [
				{data:20,label:'Data 1'},
				{data:40,label:'Data 2'},
				{data:25,label:'Data 3'},
				{data:15,label:'Data 4'}];
				
	var r = 100;
	var cx = 250;
	var cy = 200;
	var shadowSize = 4;
	
	var segments = {fills:[],shadows:[]};
	
	var total = 0;
	for(var i=0;i<data.length;i++){
		total += data[i].data;
	}
	
	var currentAngle = 90;
	var path;
	for(var i=0;i<data.length;i++){
		var rad = Math.PI / 180,
			angle = data[i].data/total * 360,
			x1 = cx + r * Math.cos(-currentAngle * rad),
			y1 = cy + r * Math.sin(-currentAngle * rad),
			xm = cx + r / 2 * Math.cos(-(currentAngle + angle / 2) * rad),
			ym = cy + r / 2 * Math.sin(-(currentAngle + angle / 2) * rad),
			endAngle = currentAngle-=angle
        	x2 = cx + r * Math.cos(-endAngle * rad),
        	y2 = cy + r * Math.sin(-endAngle * rad),
        	path = ["M", cx, cy, "L", x1, y1, "A", r, r, 0, +(Math.abs(angle) > 180), 1, x2, y2, "z"],
			shadow = ["M", cx+shadowSize, cy+shadowSize, "L", x1+shadowSize, y1+shadowSize, "A", r, r, 0, +(Math.abs(angle) > 180), 1, x2+shadowSize, y2+shadowSize, "z"];
			path.middle = {x: xm, y: ym};
			shadow.middle = {x: xm+shadowSize, y: ym+shadowSize};
		segments.fills.push(path);
		segments.shadows.push(shadow);
	}
	

	var paper = Raphael('paper');
	for(var i=0;i<segments.shadows.length;i++){
		segment = paper.path(segments.shadows[i]);
		segment.attr('fill','#000');
		segment.attr('stroke-opacity',0);
		segment.attr('fill-opacity',0.1);
		
	}
	console.log(4<segments.fills.length);
	
	for(i=0;i<segments.fills.length;i++){
		
		segment = paper.path(segments.fills[i]);
		segment.attr('fill',colors[i]);
		segment.attr('stroke-opacity',0);
		segment.hover(function(e){
			this.scale(1.1,1.1,cx,cy);
		},function(e){
			this.animate({scale: [1, 1, cx, cy]}, 500, "bounce");
		});
		
	}	
</script>
</body>
</html>