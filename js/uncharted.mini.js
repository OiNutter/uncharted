var Uncharted={};Uncharted.base=Class.create({extendOptions:function(a,c){var b,d;for(b in c){if(Object.values(a[b]).length>0&&Object.values(c[b]).length>0){for(d in c[b]){a[b][d]=c[b][d]}}else{a[b]=c[b]}}return a},initialize:function(b,c,a){if(!$(b)){throw new Error("Element does not exist: "+b)}this.options={colors:["#edc240","#00A8F0","#C0D800","#cb4b4b","#4da74d","#9440ed"],stroke:"#999",strokeOpacity:0,fillOpacity:1,clickable:true,gutter:{x:10,y:10},shadow:{show:true,size:4,fill:"#000",stroke:"#000",strokeOpacity:0,fillOpacity:0.1},legend:{show:true,marker:"square",align:"right",markerHeight:10,markerWidth:15,textColor:"#666",markerBorder:"#ccc"},grid:{show:true,horiz:true,vert:true,stroke:"#ccc"}};this.extendOptions(this.options,a||{});this.element=b;this.paper=Raphael(b);this.data=c;this.graphData=this.parseData();if(this.graphData.total==0){return false}this.width=parseFloat($(b).getWidth());this.height=parseFloat($(b).getHeight());return true},parseData:function(){var b=[],c,d=0,a;this.data.each(function(e){if((e.data==0||e.data||!e.data||e.data!=null)){c={};d+=e.data;for(a in e){c[a]=e[a]}}else{c={data:((parseFloat(e))?parseFloat(e):e)}}b.push(c)}.bind(this));return{total:d,data:b}},drawGrid:function(){var a=this.options.grid,d=this.options.gutter,b=this.paper.set(),c;this.axis.x.clone().translate(0,-this.axis.y.getBBox().height+1);c=this.axis.y.clone().translate(this.axis.x.getBBox().width-1,0);this.ticks.x.each(function(e){b.push(this.paper.path(["M",e[0],this.axis.x.getBBox().y,"L",e[0],d.y]).attr({stroke:a.stroke,"stroke-width":0.5}).toBack())}.bind(this));this.ticks.y.each(function(e){b.push(this.paper.path(["M",this.axis.y.getBBox().x,e[1],"L",c.getBBox().x,e[1]]).attr({stroke:a.stroke,"stroke-width":0.5}).toBack())}.bind(this));this.grid=b},getMarker:function(a,e,d,c){var b=this.paper.set();switch(d.marker){case"square":b.push(this.paper.rect(a-2,e-2,d.markerWidth+4,d.markerHeight+4).attr({stroke:d.markerBorder,fill:"#fff"}));b.push(this.paper.rect(a,e,d.markerWidth,d.markerHeight).attr({fill:c,"stroke-opacity":0}));return b;break;case"dot":b.push(this.paper.circle(a,e,d.markerWidth+2,d.markerHeight+2).attr({stroke:d.markerBorder,fill:"#fff"}));b.push(this.paper.circle(a,e,d.markerWidth,d.markerHeight).attr({fill:c,"stroke-opacity":0}));return b;break;default:break}},showTooltip:function(j,f,l,a,m){a=a==null?2:a;m=m||5;l=l||j+","+f;var e=this.paper.set(),i=this.paper.text(j,f,l).attr({fill:"#fff","text-anchor":"middle"}),d=i.getBBox(),k=d.width/2,b=d.height/2,g,c;e.push(this.paper.rect(j-k-5,f-b*2-15,d.width+10,d.height+10,5).attr({fill:"#000","stroke-width":0}));e.push(i.toFront());g=e.getBBox();c=g.y+12.5;if(g.y<this.options.gutter.y){c+=g.height;e.attr({y:g.y+g.height})}e[1].attr({x:g.x+g.width/2,y:c,"text-anchor":"middle"});return e},getMaxVal:function(b){var c,a;this.graphData.data.each(function(d){index=(b=="x")?0:1;a=d.data.max(function(e){return parseFloat(e[index])});c=(a>c||Object.isUndefined(c))?a:c}.bind(this));return c},getMinVal:function(b){var a,c;this.graphData.data.each(function(d){index=(b=="x")?0:1;c=d.data.min(function(e){return parseFloat(e[index])});a=(c<a||Object.isUndefined(a))?c:a}.bind(this));return a},roundNum:function(f){var e,c,a,d,b;e=-Math.floor(Math.log(f)/Math.LN10);a=this.options.yaxis.numTicks;if(a!=null&&e>a){e=a}d=Math.pow(10,-e);b=f/d;if(b<1.5){c=1}else{if(b<3){c=2;if(b>2.25&&(a==null||e+1<=a)){c=2.5;++e}}else{if(b<7.5){c=5}else{c=10}}}return c*=d},setDecimals:function(a,b){a=a.toFixed(b);if(a%1==0){return Number(a).round()}else{return a}}});Uncharted.pie=Class.create(Uncharted.base,{initialize:function($super,b,c,a){a=a||{};a=this.extendOptions({center:null,radius:null,labels:{show:true,textColor:"#666",accuracy:2}},a);if(!$super(b,c,a)){return false}this.options.center=this.options.center||{x:this.width/2,y:this.height/2};this.options.radius=this.options.radius||(this.height/3);if(this.options.legend.show){this.options.center.x=(function(d){return(d=="left")?(this.width/3)*2-25:this.width/3+25}.bind(this))(this.options.legend.align)}this.sectors=this.generateSlices();this.drawChart();this.onMouseOver=this.options.onMouseOver||this.onMouseOver;this.onMouseOut=this.options.onMouseOut||this.onMouseOut;this.slices.each(function(d){d.mouseover(this.onMouseOver.bind(d,this));d.mouseout(this.onMouseOut.bind(d,this));if(this.options.clickable){d.click(this.onClick.bind(d,this))}if(this.options.legend.show){d.key[0][1].mouseover(this.onMouseOver.bind(d,this));d.key[0][1].mouseout(this.onMouseOut.bind(d,this));d.key[1].mouseover(this.onMouseOver.bind(d,this));d.key[1].mouseout(this.onMouseOut.bind(d,this));if(this.options.clickable){d.key.click(this.onClick.bind(d,this))}}},this)},generateSlices:function(){var c={fills:[],shadows:[],labels:[]},e=90,b=Math.PI/180,d=this.options.radius,a=this.options.center.x,h=this.options.center.y,g=this.options.shadow,f=this.options.labels;this.graphData.data.each(function(r){if(r.data==0){c.fills.push(null);c.shadows.push(null);c.labels.push(null);return false}var p=r.data/this.graphData.total*360,k=a+d*Math.cos(-e*b),t=h+d*Math.sin(-e*b),q=a+d/2*Math.cos(-(e+p/2)*b),l=h+d/2*Math.sin(-(e+p/2)*b),m=e-=p,i=a+d*Math.cos(-m*b),s=h+d*Math.sin(-m*b),o=a+d*Math.cos((-m-(p/2))*b),n=h+d*Math.sin((-m-(p/2))*b),u,j;if(p!=360){u=["M",a,h,"L",k,t,"A",d,d,0,+(Math.abs(p)>180),1,i,s,"z"],j=["M",a+g.size,h+g.size,"L",k+g.size,t+g.size,"A",d,d,0,+(Math.abs(p)>180),1,i+g.size,s+g.size,"z"]}else{u=["M",a-d,h,"A",d,d,0,0,1,a+d,h,"A",d,d,0,0,1,a-d,h,"z"],j=["M",a-d+g.size,h+g.size,"A",d,d,0,0,1,a+d+g.size,h+g.size,"A",d,d,0,0,1,a-d+g.size,h+g.size,"z"]}u.middle={x:q,y:l};j.middle={x:q+g.size,y:l+g.size};if(r.link){u.url=(r.link.url)?r.link.url:r.link;u.target=r.link.target||"_self"}c.fills.push(u);o+=(o>a)?10:-10;n+=(n>h)?10:-10;if(g.show){c.shadows.push(j)}if(f.show){c.labels.push(this.paper.text(o,n,((r.data/this.graphData.total)*100).toFixed(f.accuracy)+"%").attr({"text-color":f.textColor,"text-anchor":((o>a)?"start":"end")}).toFront())}},this);return c},drawChart:function(){var f=this.options.shadow,h=this.sectors,g=[],d=this.options.legend,c=(d.align="right")?(this.width/3*2)+50:10,b=this.height/6,i=this.paper.set(),a=this.options.labels,e;if(d.show){this.graphData.data.each(function(k,j){e=this.paper.set();e.push(this.getMarker(c,b,d,this.options.colors[j]));e.push(this.paper.text(c+d.markerWidth+10,b+d.markerHeight/2,k.label).attr({fill:d.textColor,"text-anchor":"start"}));b+=e.getBBox().height+7;i.push(e)},this)}h.fills.each(function(k,j){if(k==null){return false}segment=this.paper.path(k);segment.url=k.url;segment.target=k.target;segment.attr("fill",this.options.colors[j]);segment.attr("stroke",this.options.stroke);segment.attr("stroke-opacity",this.options.strokeOpacity);segment.attr("fill-opacity",this.options.fillOpacity);if(f.show){segment.shadow=this.paper.path(h.shadows[j]);segment.shadow.attr("fill",f.fill);segment.shadow.attr("stroke",f.stroke);segment.shadow.attr("stroke-opacity",f.strokeOpacity);segment.shadow.attr("fill-opacity",f.fillOpacity);segment.shadow.toBack()}if(a.show){segment.label=h.labels[j]}if(d.show){segment.key=i[j]}g.push(segment)}.bind(this));this.slices=g},onMouseOver:function(b){var a=b.options.center.x,e=b.options.center.y,d=b.options.shadow,c;this.stop();if(this.url){$(b.element).style.cursor="pointer"}this.scale(1.1,1.1,a,e);if(this.shadow){this.shadow.scale(1.1,1.1,a+d.size,e+d.size)}if(this.key){this.key[0].stop();this.key[0].scale(1.2);this.key[1].attr({"font-weight":800})}if(this.label){this.label.stop();c=this.label.getBBox();xmod=c.x>a?5:-5;ymod=c.y>e?5:-5;this.label.translate(xmod,ymod)}},onMouseOut:function(b){var a=b.options.center.x,e=b.options.center.y,d=b.options.shadow,c;if($(b.element).style.cursor=="pointer"){$(b.element).style.cursor="default"}this.animate({scale:[1,1,a,e]},500,"bounce");if(this.shadow){this.shadow.animateWith(this,{scale:[1,1,a+d.size,e+d.size]},500,"bounce")}if(this.key){this.key[0].animateWith(this,{scale:1},500,"bounce");this.key[1].attr({"font-weight":400})}if(this.label){c=this.label.getBBox();xmod=c.x<a?5:-5;ymod=c.y<e?5:-5;this.label.animateWith(this,{translation:[xmod,ymod]},100,"bounce")}},onClick:function(a){switch(this.target){case"_self":window.location.href=this.url;break;case"_blank":window.open(this.url);break;default:break}}});Uncharted.bar=Class.create(Uncharted.base,{initialize:function($super,b,c,a){a=a||{};a=this.extendOptions({xaxis:{max:null,min:null,increment:1,gap:null,x:null,y:null,minSize:20},yaxis:{max:null,min:0,increment:1,gap:null,x:null,y:null,minSize:20},shadow:{size:2},legend:{position:"inside"},points:{show:false,marker:"dot",markerWidth:4,markerHeight:4,markerBorder:"#ccc"},tags:{show:true,marker:"popup",markerWidth:4,markerHeight:4,format:"x + ',' + y"},labels:{show:true,showOn:"rollover"}},a);if(!$super(b,c,a)){return false}this.generateAxisRanges();this.generateAxisLabels();this.drawAxis();this.drawGrid();this.sets=this.generateBars();this.drawChart();this.axis.x.toFront();if(this.options.legend.show){this.legend.toFront()}},generateAxisRanges:function(){var a,b;this.options.xaxis.max=this.getMaxBars()+1;this.options.xaxis.min=0;this.options.yaxis.max=(Object.isNumber(this.options.yaxis.max))?this.options.yaxis.max:this.getMaxVal("y");this.options.yaxis.min=(Object.isNumber(this.options.yaxis.min))?this.options.yaxis.min:this.getMinVal("y");if(this.options.yaxis.increment!="auto"&&(this.options.yaxis.max-this.options.yaxis.min)%this.options.yaxis.increment>0){this.options.yaxis.max+=this.options.yaxis.increment-((this.options.yaxis.max-this.options.yaxis.min)%this.options.yaxis.increment)}a=0;if(this.options.legend.show){this.legend=this.drawLegend();a=this.legend.getBBox().width+10}if(this.options.labels.show&&this.options.yaxis.increment!="auto"){this.options.yaxis.max+=this.options.yaxis.increment}if(this.options.xaxis.increment=="auto"){b=(this.options.xaxis.minSize*(this.options.xaxis.max-this.options.xaxis.min))/(this.width-30-this.options.gutter.x*2-a);this.options.xaxis.increment=this.roundNum(b);if(this.options.xaxis.max%this.options.xaxis.increment>this.options.xaxis.min){this.options.xaxis.max+=this.options.xaxis.increment-(this.options.xaxis.max%this.options.xaxis.increment)}}if(this.options.yaxis.increment=="auto"){b=(this.options.yaxis.minSize*(this.options.yaxis.max-this.options.yaxis.min))/(this.height-30-this.options.gutter.y*2);this.options.yaxis.increment=this.roundNum(b);if(this.options.yaxis.max%this.options.yaxis.increment>this.options.yaxis.min){this.options.yaxis.max+=this.options.yaxis.increment-(this.options.yaxis.max%this.options.yaxis.increment)}}this.options.xaxis.gap=((this.width-30-this.options.gutter.x*2-a)/((this.options.xaxis.max-this.options.xaxis.min)/this.options.xaxis.increment));this.options.yaxis.gap=((this.height-30-this.options.gutter.y*2)/((this.options.yaxis.max-this.options.yaxis.min)/this.options.yaxis.increment))},generateAxisLabels:function(){this.labels={x:[""],y:[0]};this.graphData.data.each(function(a){a.data.each(function(b){if(this.labels.x.indexOf(b[0])==-1){this.labels.x.push(b[0])}if(this.labels.y.indexOf(b[1])==-1){this.labels.y.push(b[1])}}.bind(this))}.bind(this))},generateBars:function(){var e=[],f,d,a=this.options.xaxis.gap,h=this.options.yaxis.gap,c=this.options.xaxis.increment,b=this.options.yaxis.increment,g=this.options.labels;this.graphData.data.each(function(i,j){d={bars:[],labels:[]};i.data.each(function(o,l){var m=a/(1.5*this.graphData.data.length),k=((parseFloat(o[1])-this.options.yaxis.min)/b)*h+((parseFloat(o[1])>0)?3:0),p=2+((this.labels.x.indexOf(o[0]))/c)*a+this.axis.x.getBBox().x-(((a/1.5)/2)-(m*j)),n=this.axis.x.getBBox().y-((parseFloat(o[1])-this.options.yaxis.min)/b)*h-3;f=[p,n,m,k];d.bars.push(f);if(g.show){d.labels.push(this.paper.text(p+(m/2),n-10,o[1]))}}.bind(this));e.push(d)}.bind(this));return e},drawLegend:function(){var h=this.paper.set(),i=this.paper.set(),g,f=this.options.legend,a=this.options.gutter,e=a.x+20,d=a.y+10,c,b;this.graphData.data.each(function(k,j){g=this.paper.set();g.push(this.getMarker(e,d,f,this.options.colors[j]));g.push(this.paper.text(e+f.markerWidth+10,d+f.markerHeight/2,k.label).attr({fill:f.textColor,"text-anchor":"start"}));Event.observe(g[0][1].node,"mouseover",this.onMouseOverLegend.bind(g,this));Event.observe(g[0][1].node,"mouseout",this.onMouseOutLegend.bind(g,this));Event.observe(g[0][1].node,"click",this.onClickLegend.bind(g,this));Event.observe(g[1].node,"mouseover",this.onMouseOverLegend.bind(g,this));Event.observe(g[1].node,"mouseout",this.onMouseOutLegend.bind(g,this));g.visible=true;d+=g.getBBox().height+7;h.push(g)}.bind(this));c=h.getBBox();if(f.position&&f.position=="inside"){i.push(this.paper.rect(this.width-a.x-25-c.width,a.y+10,c.width+10,c.height+10).attr({stroke:this.options.stroke,fill:"#fff"}));b=i.getBBox();h.translate(b.x-c.x+5,b.y-c.y+5)}else{h.translate((this.width-c.width-5)-c.x-a.x,0)}i.push(h);this.keys=h;return i},drawAxis:function(){var b=0,e=this.labels.x,a=this.paper.set(),g=this.paper.set(),c=this.options.gutter,k={x:[],y:[]},d,h,j,f,l;for(d=this.options.yaxis.max;d>=this.options.yaxis.min;d-=this.options.yaxis.increment){if(d!=this.options.yaxis.min){k.y.push([25,(b*this.options.yaxis.gap)+10+c.y])}a.push(this.paper.text(25,(b*this.options.yaxis.gap)+10+c.y,String.interpret(this.setDecimals(d,2))).attr({"text-anchor":"end"}));b++}f=a.getBBox();a.attr("x",f.width+c.x);f=a.getBBox();h=this.paper.path("M"+(f.width+c.x+5)+" "+c.y+"L"+(f.width+c.x+5)+" "+(f.height+c.y)).attr({stroke:this.options.stroke,"stroke-width":2});h.labels=a;b=0;if(this.options.legend.show&&this.options.legend.position=="inside"){this.options.xaxis.max+=((this.legend.getBBox().width+c.x)/this.options.xaxis.gap)*this.options.xaxis.increment}for(d=this.options.xaxis.min;d<=this.options.xaxis.max;d+=this.options.xaxis.increment){if(d!=this.options.xaxis.min){k.x.push([(f.width+c.x+7)+((b*this.options.xaxis.gap)),(this.height-20)])}g.push(this.paper.text((f.width+c.x+7)+((b*this.options.xaxis.gap)),(f.height+c.y+10),e[d]).attr({"text-anchor":"middle"}));b++}l=g.getBBox();extraWidth=0;if(this.options.legend.show&&this.options.legend.position=="inside"){extraWidth=(this.width-(c.x*2)-5-f.width-f.x)-((b-1)*this.options.xaxis.gap)}j=this.paper.path("M"+(f.width+c.x+5)+" "+(f.height+c.y)+"L"+((b-1)*this.options.xaxis.gap+f.width+6+f.x+extraWidth)+" "+(f.height+c.y)).attr({stroke:this.options.stroke,"stroke-width":2});j.labels=g;this.axis={x:j,y:h};this.ticks=k},drawChart:function(){var b=[],a,c;this.sets.each(function(e,d){a=this.paper.set();e.bars.each(function(f){c=this.paper.rect(f[0],f[1],f[2],f[3]).attr({fill:this.options.colors[d],"stroke-opacity":this.options.strokeOpacity});a.push(c)}.bind(this));b.push(a);if(this.options.legend.show){this.keys[d].bars=a}}.bind(this));this.bars=b},getMaxBars:function(){return this.graphData.data.max(function(a){return a.data.length})},onMouseOverLegend:function(a){this[0].stop();this[0].scale(1.2);this[1].attr({"font-weight":800});a.bars.each(function(c){if(c!=this.bars){c.attr("fill-opacity",a.options.fillOpacity/3)}}.bind(this))},onMouseOutLegend:function(a){this[0].stop();this[0].animate({scale:1},500,"bounce");this[1].attr({"font-weight":400});a.bars.each(function(c){if(c!=this.bars){c.attr("fill-opacity",a.options.fillOpacity)}}.bind(this))},onClickLegend:function(a){var b;if(this.visible){this.visible=false;this[0][1].attr("fill-opacity",0);this.bars.hide();Event.stopObserving(this[0][1].node,"mouseover");Event.stopObserving(this[0][1].node,"mouseout");Event.stopObserving(this[1].node,"mouseover");Event.stopObserving(this[1].node,"mouseout");b=a.onMouseOutLegend.bind(this,a);b()}else{this.visible=true;this[0][1].attr("fill-opacity",1);this.bars.show();Event.observe(this[0][1].node,"mouseover",a.onMouseOverLegend.bind(this,a));Event.observe(this[0][1].node,"mouseout",a.onMouseOutLegend.bind(this,a));Event.observe(this[1].node,"mouseover",a.onMouseOverLegend.bind(this,a));Event.observe(this[1].node,"mouseout",a.onMouseOutLegend.bind(this,a))}},onMouseOver:function(a){}});Uncharted.line=Class.create(Uncharted.base,{initialize:function($super,b,c,a){a=a||{};a=this.extendOptions({xaxis:{max:null,min:null,increment:1,gap:null,x:null,y:null,minSize:20},yaxis:{max:null,min:null,increment:10,gap:null,x:null,y:null,minSize:20},shadow:{size:2},legend:{position:"inside"},points:{show:false,marker:"dot",markerWidth:4,markerHeight:4,markerBorder:"#ccc"},tags:{show:true,marker:"popup",markerWidth:4,markerHeight:4,format:"x + ',' + y"}},a);if(!$super(b,c,a)){return false}this.onMouseOver=this.options.onMouseOver||this.onMouseOver;this.onMouseOut=this.options.onMouseOut||this.onMouseOut;this.onMouseOverLegend=this.options.legend.onMouseOver||this.onMouseOverLegend;this.onMouseOutLegend=this.options.legend.onMouseOut||this.onMouseOutLegend;this.onClickLegend=this.options.legend.onClick||this.onClickLegend;this.generateAxisRanges();this.drawAxis();this.drawGrid();this.series=this.generatePaths();this.drawChart();if(this.options.legend.show){this.legend.toFront()}},generateAxisRanges:function(){var a,b;this.options.xaxis.max=(Object.isNumber(this.options.xaxis.max))?this.options.xaxis.max:this.getMaxVal("x");this.options.xaxis.min=(Object.isNumber(this.options.xaxis.min))?this.options.xaxis.min:this.getMinVal("x");this.options.yaxis.max=(Object.isNumber(this.options.yaxis.max))?this.options.yaxis.max:this.getMaxVal("y");this.options.yaxis.min=(Object.isNumber(this.options.yaxis.min))?this.options.yaxis.min:this.getMinVal("y");if(this.options.xaxis.increment!="auto"&&(this.options.xaxis.max-this.options.xaxis.min)%this.options.xaxis.increment>0){this.options.xaxis.max+=this.options.xaxis.increment-((this.options.xaxis.max-this.options.xaxis.min)%this.options.xaxis.increment)}if(this.options.yaxis.increment!="auto"&&(this.options.yaxis.max-this.options.yaxis.min)%this.options.yaxis.increment>0){this.options.yaxis.max+=this.options.yaxis.increment-((this.options.yaxis.max-this.options.yaxis.min)%this.options.yaxis.increment)}a=0;if(this.options.legend.show){this.legend=this.drawLegend();a=this.legend.getBBox().width+10}if(this.options.xaxis.increment=="auto"){b=(this.options.xaxis.minSize*(this.options.xaxis.max-this.options.xaxis.min))/(this.width-30-this.options.gutter.x*2-a);if(!Object.isUndefined(this.options.monthNames)){b/=60}this.options.xaxis.increment=this.roundNum(b);if(!Object.isUndefined(this.options.monthNames)){this.options.xaxis.increment*=60}if(this.options.xaxis.max%this.options.xaxis.increment>this.options.xaxis.min){this.options.xaxis.max+=this.options.xaxis.increment-(this.options.xaxis.max%this.options.xaxis.increment)}}if(this.options.yaxis.increment=="auto"){b=(this.options.yaxis.minSize*(this.options.yaxis.max-this.options.yaxis.min))/(this.height-30-this.options.gutter.y*2);this.options.yaxis.increment=this.roundNum(b);if(this.options.yaxis.max%this.options.yaxis.increment>this.options.yaxis.min){this.options.yaxis.max+=this.options.yaxis.increment-(this.options.yaxis.max%this.options.yaxis.increment)}}this.options.xaxis.gap=((this.width-30-this.options.gutter.x*2-a)/((this.options.xaxis.max-this.options.xaxis.min)/this.options.xaxis.increment));this.options.yaxis.gap=((this.height-30-this.options.gutter.y*2)/((this.options.yaxis.max-this.options.yaxis.min)/this.options.yaxis.increment))},generatePaths:function(){var c,a,k=[],e,d,h=this.options.shadow,i=this.options.points,b=this.options.xaxis.gap,j=this.options.yaxis.gap,g=this.options.xaxis.increment,f=this.options.yaxis.increment;this.graphData.data.each(function(l){e={line:null,shadow:null,points:null};d=[];path=null,shadowPath=null;l.data.each(function(n){var o=((parseFloat(n[0])-this.options.xaxis.min)/g)*b+this.axis.x.getBBox().x,m=this.axis.x.getBBox().y-((parseFloat(n[1])-this.options.yaxis.min)/f)*j-2;if(path==null){path=["M",o,m]}if(shadowPath==null){shadowPath=["M",o+h.size,m+h.size]}path=path.concat(["L",o,m]);shadowPath=shadowPath.concat(["L",o+h.size,m+h.size]);d.push(this.getMarker(o,m,i,"#000"))}.bind(this));e.line=path;e.shadow=shadowPath;e.points=d;c=null;a=null;k.push(e)}.bind(this));return k},drawLegend:function(){var h=this.paper.set(),i=this.paper.set(),g,f=this.options.legend,a=this.options.gutter,e=a.x+20,d=a.y+10,c,b;this.graphData.data.each(function(k,j){g=this.paper.set();g.push(this.getMarker(e,d,f,this.options.colors[j]));g.push(this.paper.text(e+f.markerWidth+10,d+f.markerHeight/2,k.label).attr({fill:f.textColor,"text-anchor":"start"}));Event.observe(g[0][1].node,"mouseover",this.onMouseOverLegend.bind(g,this));Event.observe(g[0][1].node,"mouseout",this.onMouseOutLegend.bind(g,this));Event.observe(g[0][1].node,"click",this.onClickLegend.bind(g,this));Event.observe(g[1].node,"mouseover",this.onMouseOverLegend.bind(g,this));Event.observe(g[1].node,"mouseout",this.onMouseOutLegend.bind(g,this));g.visible=true;d+=g.getBBox().height+7;h.push(g)}.bind(this));c=h.getBBox();if(f.position&&f.position=="inside"){i.push(this.paper.rect(this.width-a.x-25-c.width,a.y+10,c.width+10,c.height+10).attr({stroke:this.options.stroke,fill:"#fff"}));b=i.getBBox();h.translate(b.x-c.x+5,b.y-c.y+5)}else{h.translate((this.width-c.width-5)-c.x-a.x,0)}i.push(h);this.keys=h;return i},drawAxis:function(){var b=0,a=this.paper.set(),f=this.paper.set(),c=this.options.gutter,j={x:[],y:[]},d,g,h,e,k;for(d=this.options.yaxis.max;d>=this.options.yaxis.min;d-=this.options.yaxis.increment){if(d!=this.options.yaxis.min){j.y.push([25,(b*this.options.yaxis.gap)+10+c.y])}a.push(this.paper.text(25,(b*this.options.yaxis.gap)+10+c.y,String.interpret(this.setDecimals(d,2))).attr({"text-anchor":"end"}));b++}e=a.getBBox();a.attr("x",e.width+c.x);g=this.paper.path("M"+(e.width+c.x+5)+" "+c.y+"L"+(e.width+c.x+5)+" "+(e.height+c.y)).attr({stroke:this.options.stroke,"stroke-width":2});g.labels=a;b=0;if(this.options.legend.show&&this.options.legend.position=="inside"){this.options.xaxis.max+=((this.legend.getBBox().width+c.x)/this.options.xaxis.gap)*this.options.xaxis.increment}for(d=this.options.xaxis.min;d<=this.options.xaxis.max;d+=this.options.xaxis.increment){if(d!=this.options.xaxis.min){j.x.push([(e.width+c.x+5)+((b*this.options.xaxis.gap)),(this.height-20)])}f.push(this.paper.text((e.width+c.x+5)+((b*this.options.xaxis.gap)),(e.height+c.y+10),String.interpret(d)).attr({"text-anchor":"middle"}));b++}k=f.getBBox();extraWidth=0;if(this.options.legend.show&&this.options.legend.position=="inside"){extraWidth=(this.width-(c.x*2)-5-e.width)-k.width}h=this.paper.path("M"+(e.width+c.x+5)+" "+(e.height+c.y)+"L"+(k.width+e.width+6+extraWidth)+" "+(e.height+c.y)).attr({stroke:this.options.stroke,"stroke-width":2});h.labels=f;this.axis={x:h,y:g};this.ticks=j},drawChart:function(){var lines=[],shadow=this.options.shadow,points=this.options.points,x,y;this.series.each(function(s,i){seriesLine=this.paper.path(s.line).attr({stroke:this.options.colors[i],"stroke-width":3});if(shadow.show){seriesLine.shadow=this.paper.path(s.shadow).attr({stroke:shadow.fill,"stroke-width":3,"stroke-opacity":shadow.fillOpacity})}seriesLine.points=this.paper.set();s.points.each(function(p,n){p[1].attr("fill",this.options.colors[i]).toFront();if(!points.show){p.attr({"fill-opacity":0,"stroke-opacity":0})}Event.observe(p[1].node,"mouseover",this.onMouseOver.bind(p,this));Event.observe(p[1].node,"mouseout",this.onMouseOut.bind(p,this));x=parseFloat(this.graphData.data[i].data[n][0]);y=this.graphData.data[i].data[n][1];p.label=eval(this.options.tags.format);seriesLine.points.push(p)}.bind(this));lines.push(seriesLine);if(this.options.legend.show){this.keys[i].line=seriesLine}}.bind(this));this.lines=lines},onMouseOver:function(a){var c=this.getBBox(),b;if(!a.toolTip||a.toolTip==null){a.toolTip=a.showTooltip(c.x+c.width/2,c.y+c.height/2,this.label);a.toolTip[0].attr("fill",this[1].attr("fill"))}else{clearTimeout(a.toolTimer);a.toolTip[1].attr("text",this.label);b=a.toolTip[1].getBBox();a.toolTip[0].animate({width:b.width+10,height:b.height+10,x:(c.x+c.width/2)-(b.width/2)-5,y:((c.y-b.height-10)>=a.options.gutter.y)?c.y-b.height-10:c.y+10,fill:this[1].attr("fill")},200);a.toolTip[1].animateWith(a.toolTip[0],{x:(c.x+c.width/2),y:((c.y-b.height-10)>=a.options.gutter.y)?(c.y-c.height/2)-b.height+7.5:c.y+b.height+7.5},200)}},onMouseOut:function(a){a.toolTimer=setTimeout(function(){a.toolTip.remove();a.toolTip=null},2000)},onMouseOverLegend:function(b){var c=b.options.shadow,a=b.options.points;this[0].stop();this[0].scale(1.2);this[1].attr({"font-weight":800});b.lines.each(function(d){if(d!=this.line){d.attr("stroke-opacity",b.options.fillOpacity/3);if(c.show){d.shadow.attr("",c.fillOpacity/3)}if(a.show){d.points.attr("fill-opacity",b.options.fillOpacity/3)}}}.bind(this));this.line.toFront()},onMouseOutLegend:function(b){var c=b.options.shadow,a=b.options.points;this[0].stop();this[0].animate({scale:1},500,"bounce");this[1].attr({"font-weight":400});b.lines.each(function(d){if(d!=this.line){d.attr("stroke-opacity",b.options.fillOpacity);if(c.show){d.shadow.attr("stroke-opacity",c.fillOpacity)}if(a.show){d.points.attr("fill-opacity",b.options.fillOpacity)}}}.bind(this))},onClickLegend:function(b){var d=b.options.shadow,a=b.options.points,c;if(this.visible){this.visible=false;this[0][1].attr("fill-opacity",0);this.line.hide();if(d.show){this.line.shadow.hide()}if(a.show){this.line.points.hide()}$A(this.line.points).each(function(e){Event.stopObserving(e[1].node,"mouseover");Event.stopObserving(e[1].node,"mouseout")});Event.stopObserving(this[0][1].node,"mouseover");Event.stopObserving(this[0][1].node,"mouseout");Event.stopObserving(this[1].node,"mouseover");Event.stopObserving(this[1].node,"mouseout");c=b.onMouseOutLegend.bind(this,b);c()}else{this.visible=true;this[0][1].attr("fill-opacity",1);this.line.show();if(d.show){this.line.shadow.show()}if(a.show){this.line.points.show()}$A(this.line.points).each(function(e){Event.observe(e[1].node,"mouseover",b.onMouseOver.bind(e,b));Event.observe(e[1].node,"mouseover",b.onMouseOver.bind(e,b))});Event.observe(this[0][1].node,"mouseover",b.onMouseOverLegend.bind(this,b));Event.observe(this[0][1].node,"mouseout",b.onMouseOutLegend.bind(this,b));Event.observe(this[1].node,"mouseover",b.onMouseOverLegend.bind(this,b));Event.observe(this[1].node,"mouseout",b.onMouseOutLegend.bind(this,b))}}});Uncharted.time=Class.create(Uncharted.line,{initialize:function($super,b,c,a){a=a||{};a=this.extendOptions({monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],xaxis:{increment:"auto",minSize:50},tags:{format:"this.options.monthNames[(new Date(x)).getMonth()] + ' ' + (new Date(x)).getDate() + ',' + y"}},a);if(Object.isString(a.xaxis.increment)){a.xaxis.increment=this.getTimeForPeriod(a.xaxis.increment)}if(!$super(b,c,a)){return false}},getTimeForPeriod:function(a){switch(a){case"millisecond":return 1;break;case"second":return 1000;break;case"minute":return 60000;break;case"hour":return 3600000;break;case"day":return 86400000;break;case"week":return 604800000;break;case"auto":return a;break;default:return 2419200000;break}},drawAxis:function(){var c=this.options.yaxis.max/this.options.yaxis.increment,b=this.paper.set(),m=this.paper.set(),f=this.options.gutter,p={x:[],y:[]},h=this.options.monthNames,g,k,o,l,j,q,a=-f.x,e=0;for(g=this.options.yaxis.min;g<=this.options.yaxis.max;g+=this.options.yaxis.increment){if(g!=this.options.yaxis.min){p.y.push([25,(c*this.options.yaxis.gap)+10+f.y+e])}b.push(this.paper.text(25,(c*this.options.yaxis.gap)+10+f.y+e,String.interpret(this.setDecimals(g,2))).attr({"text-anchor":"end"}));c--}j=b.getBBox();b.attr("x",j.width+f.x);l=this.paper.path("M"+(j.width+f.x+5)+" "+f.y+"L"+(j.width+f.x+5)+" "+(j.height+f.y+e)).attr({stroke:this.options.stroke,"stroke-width":2});l.labels=b;c=0;if(this.options.legend.show&&this.options.legend.position=="inside"){this.options.xaxis.max+=((this.legend.getBBox().width+f.x)/this.options.xaxis.gap)*this.options.xaxis.increment}for(g=this.options.xaxis.min;g<=this.options.xaxis.max;g+=this.options.xaxis.increment){k=new Date(g);if(g!=this.options.xaxis.min){p.x.push([(j.width+f.x+5)+((c*this.options.xaxis.gap)),(this.height-20)])}m.push(this.paper.text((j.width+f.x+5)+((c*this.options.xaxis.gap)),(j.height+f.y+10+e),h[k.getMonth()]+" "+k.getDate()).attr({"text-anchor":"middle"}));c++}q=m.getBBox();if(this.options.legend.show){if(this.options.legend.position=="inside"){a=(this.width-(f.x*2)-5-j.width)-q.width}else{a=(this.legend.getBBox().x-f.x-j.width)-q.width}}o=this.paper.path("M"+(j.width+f.x+5)+" "+(j.height+f.y+e)+"L"+(q.width+j.width+6+a)+" "+(j.height+f.y+e)).attr({stroke:this.options.stroke,"stroke-width":2});o.labels=m;this.axis={x:o,y:l};this.ticks=p}});